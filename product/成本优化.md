# 成本优化
## 操作场景
容器服务的成本优化工具支持分析用户节点资源的资源利用率及范围分布，分析对象包括虚拟机、TKE节点；提出上云成熟度模型，并提供成本优化建议，提升资源使用率，帮助企业轻松上云，降本增效。

## 资源利用率成熟度模型
通过腾讯云原生团队对授权客户数据的调研，分析各个客户上云阶段的资源利用率情况，发现充分利用弹性伸缩能力，是提高资源利用率，降低资源成本的关键点之一，对比未使用弹性伸缩的情况下整体资源利用率能够提高20%、30%以上。为此腾讯云原生团队提出了容器化资源利用率成熟度模型，


![](https://main.qcloudimg.com/raw/eec315c150fdc1742886a6cb9c2221ac.jpg)

第一阶段：传统部署模型， 业务为应对不同时间段计算资源使用不同的情况，必须以最高使用资源的峰值加一定的 buff 进行基础设施的采购，平均利用率降低。

第二阶段：简单容器化改造后的业务，上云并容器化改造，利用了容器进行业务混合部署，一定程度提高了资源利用率。

第三阶段：业务进行微服务改造，业务可利用容器和云的弹性伸缩能力，结合 Kubernetes 的HPA、VPA、CA 等能力，高峰扩容、空闲缩容，极大提高资源利用率。

第四阶段：极致利用云和容器化后的弹性， 提高弹性伸缩灵敏度和精度， 有离线业务的进行在离线混布，极致提高平均资源利用率。


## 资源利用率分析
通过 CPU 平均利用率、 CPU 高利用率节点（TOP 10）、 CPU 低利用率节点（TOP 10）、 CPU利用率分布饼图等，协助您了解公司业务的资源的使用情况。
![](https://main.qcloudimg.com/raw/a5f70d33bf47a7de34365b438330faf5.png)
![](https://main.qcloudimg.com/raw/7061d53c7a482c8304cf1eb95ff50712.png)

## 成本优化建议
根据您的业务特征，匹配典型的成本浪费现象，并给出解决该浪费现象的成本优化建议。

### 周期性业务
业务特征：业务流量呈现周期性。通常业务会按照波峰值去申请资源，在负载较低时利用率很低。若配置了弹性伸缩能力（分钟级），优化空间也有限。

成本优化建议：
1、业务进行容器化改造后，基于K8s的调度编排能力、及资源管理，在保障业务的稳定性的同时有效提升资源利用率。
2、定时弹性伸缩解决方案
- cronHPA（Horizontal Pod Autoscaler）：在达到用户自定义设置的时间时在30s內自动扩缩pod数量；
- CA（Cluster Autoscaler）：当受到节点资源限制导致 Pod pending 时，再触发节点层级的扩缩容；
- 对于短时间内的流量突发，支持TKE集群秒级弹性扩容EKS Pod（Elastic Kubernetes Service），无需重新购买节点。
![](https://main.qcloudimg.com/raw/45f444ccc83f3f4432ad0dabb9c21c0f.png)

### 流量突发性业务

业务特征：业务流量具备不定时突发性，为了保证高峰时期的业务稳定和良好性能，资源规格配置一般会留有较大的buffer，在日常时存在巨大的资源浪费。

成本优化建议：
1、业务进行容器化改造
基于K8s的调度编排能力，支持按照Pod真实负载进行动态调度，提升节点资源利用率；
智能资源管理，智能request推荐、Resource Quota、Limit Ranges，在保障业务的稳定性的同时有效提升资源利用率。
2、弹性伸缩解决方案
- HPA（Horizontal Pod Autoscaler）：在达到用户自定义阈值（CPU利用率、CPU使用量等）时在30s內自动扩缩pod数量；
- CA（Cluster Autoscaler）：当受到节点资源限制导致 Pod pending 时，触发节点层级的扩缩容；
- 对于短时间内的流量突发，支持TKE集群秒级弹性扩容EKS Pod（Elastic Kubernetes Service），无需重新购买节点。
![](https://main.qcloudimg.com/raw/b2c60e9499e776d3b287335e3d1d7d71.png)
